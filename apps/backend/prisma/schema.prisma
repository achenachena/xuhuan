generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Player {
  id         String   @id
  username   String
  level      Int      @default(1)
  experience Int      @default(0)
  credits    Int      @default(0)
  energy     Int      @default(120)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  runs       Run[]
}

model Character {
  id               String   @id @default(cuid())
  slug             String   @unique
  name             String
  vtuberArchetype  String   // "idol", "gamer", "artist", "chaotic", "seiso", "apex-predator"
  bio              String
  
  // Visual assets (Vercel Blob paths)
  portraitBlobPath String   @map("portraitUrl") // Blob storage path for square portrait
  modelBlobPath    String   @map("spriteUrl")   // Blob storage path for animated model/sprite
  
  // Base stats (at level 1)
  baseHealth       Int
  baseAttack       Int
  baseDefense      Int
  baseSpeed        Int
  baseCritRate     Float    @default(0.1)
  baseCritDamage   Float    @default(0.5)
  
  // Special move
  specialMoveName  String
  specialMoveDesc  String
  specialMoveType  String   // "fire", "water", "lightning", "shadow", "star", "sound"
  
  // Metadata
  rarity           String   @default("common") // common, rare, epic, legendary
  colorTheme       String   // Primary color (hex)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Encounter {
  id                     String   @id @default(cuid())
  slug                   String   @unique
  name                   String
  level                  Int
  maxHealth              Int
  attack                 Int
  defense                Int
  speed                  Int
  critRate               Float    @default(0.1)
  critDamage             Float    @default(0.5)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  imageUrl               String?
  specialMoveDescription String?
  specialMoveName        String?
  vtuberName             String?
  runs                   Run[]
}

model Run {
  id               String         @id @default(cuid())
  playerId         String
  encounterId      String
  seed             String
  status           RunStatus      @default(ACTIVE)
  outcome          BattleOutcome?
  rewardExperience Int            @default(0)
  rewardCredits    Int            @default(0)
  log              Json?
  createdAt        DateTime       @default(now())
  completedAt      DateTime?
  encounter        Encounter      @relation(fields: [encounterId], references: [id])
  player           Player         @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId, createdAt])
  @@index([encounterId, createdAt])
}

enum BattleOutcome {
  VICTORY
  DEFEAT
}

enum RunStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}
